# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/ModalData/ — папка с классами моделей данных
- src/components/ModalData/ — папка с классами отображения
Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/sсss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, используемые в приложении

Карточка

```
interface ICard {
  title:string;
  id: string;
  description?: string;
  image?:string;
  price: number | null;
  category?: string;
}
```

Заказ

```
interface IOrder {
  payment: string,
  email: string,
  phone: string,
  address:string,
  total: number,
  items: string[],
}
```

Корзина
```
interface IBasket {
  products:TBascketCard[];
  addinBasket(card: TBascketCard):void;
  removefromBasket(id:string):void; 
  getFullPrice():number;
  getCardsinBasket():number;
  getCardList():string[];
  clearBasket():void;
}
```

Форма
```
interface IForm {
  setFormPay(field: keyof TFormPay, value: string):boolean;
  setFormUser(field: keyof TFormUser, value: string):boolean;
  setItems (items:string[]):void;
  setTotal (total:number):void;
  getUserInfo():IOrder;
}
```

Интерфейс для ответа от сервера

```
interface IApiResponse {
  items: ICard[];
}
```
Интерфейс для модели данных карточек

```
interface ICardsData {
  cards: ICard[];
  getcard(id:string):ICard; 
}
```

Данные карточки, используемые в корзине при отображении карточек
```
type TBascketCard = Pick<ICard, 'title' | 'price' | 'id'>;
```

Данные ошибок формы

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```
Данные заказа в форме order
```
type TFormPay = Pick<IOrder, 'payment' | 'address'>;
```
Данные заказа в форме contacts
```
type TFormUser = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных


#### Класс CardsModel
Класс отвечает за хранение и логику работы с данными карточек созданных пользователями.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- cards: ICard[] - массив объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getCard(id: string): ICard - возвращает карточку по ее id
- а так-же сеттер и геттер для сохранения и получения данных карточки

#### Класс Basket
Класс отвечает за хранение и логику работы с корзиной товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _products: TBascketCard[] - массив карточек, находящихся в корзине
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addinBasket(card: TBascketCard):void - добавляет карточку в корзину
- removefromBasket(id:string):void; - удаляет карточку из корзины
- getFullPrice():number; - возвращает полную стоимость товаров в корзине
- getCardsinBasket():number; - возвращает количество товаров в корзине
- getCardList():string[]; - возвращает массив id карточек, находящихся в корзине
- clearBasket():void; - удаляет все товары из корзины
- а так-же сеттер и геттер для сохранения и получения данных карточек, находящихся в корзине

#### Класс ModelApi
Расширяет базовый класс Api
Класс отвечает за получение карточек товара с сервера и отправку данных о заказе и пользователе на сервер.\
Конструктор класса принимает те же данные что и базовый класс Api\
Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getCards():Promise<IApiResponse> - возвращает карточки с сервера;
- postOrder(data: IOrder) - отправляет данные о заказе на сервер.

#### Класс FormModel
Класс отвечает за хранение данных о заказе и пользователе и за валидацию и логику работы с формами .\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- order: IOrder = {
		payment: '',
		email: '',
		phone: '',
		address: '',
		total: 0,
		items: [],
	}; - объект, содержащий данные о пользователе(телефон, адрес, е-mail), выбранный способ оплаты, сумму заказа  и список id карточек, выбранных товаров;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных;
- formErrors: FormErrors - объект содержащий информацию об ошиках валидации для каждого из полей (адрес, телефон, e-mail, выбор способа оплаты)
Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setFormPay(field: keyof TFormPay, value: string):boolean - сохраняет выбранный способ оплаты и адрес пользователя, валидирует введенные данные пользователя
- setFormUser(field: keyof TFormUser, value: string):boolean - сохраняет телефон и e-mail пользователя, валидирует введенные данные пользователя
- setItems (items:string[]):void - сохраняет в объект order массив id карточек, находящихся в корзине;
- setTotal (total:number):void - сохраняет в объект order полную стоимость корзины
- getUserInfo():IOrder - возвращает данные заказа и данные введенные пользователем



### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает DOM элемент темплейта модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _closeButton: HTMLButtonElement - кнопка закрытия модального окна;
- _content: HTMLElement - элемент, в который вставляется содержимое для отображения разных модальных окон сайта;
- _wrapper: HTMLElement - элемент обертки для главной страницы сайта

Методы:
- сеттер content - заменяет содержимое модального окна
- open():void - открывает модальное окно
- close():void - закрывает модальное окно
- render(data: IModalData): HTMLElement - расширяет родительский метод render, управляет отображением модального окна, а также открывает его.
- сеттер locked - блокирует прокрутку страницы при открытии модального окна; при закрытии модального окна возвращает возможность прокрутки страницы


#### Класс FormView
 Предназначен для отображения форм внутри модального окна. 
 Устанавливает слушатели на клик принажатии на кнопки выбора способа оплаты, кнопку подтверждения формы и слушатель на изменения вводимых данных в поле input
constructor(container: HTMLElement, events: IEvents) Конструктор принимает DOM элемент темплейта формы и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса:
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных;
- submitButton: HTMLButtonElement - кнопка подтверждения
- formName: string - значение атрибута name формы
- _errors: HTMLElement - элемент разметки, где отображаются ошибки валидации формы;
- _paymentButton?: HTMLButtonElement[] - массив кнопок, отвечающих за выбор способа оплаты

Методы:
- сеттер valid - меняет активность кнопки подтверждения в зависимости от валидности введенных данных
- сеттер errors - отображает ошибки валидации формы


#### Класс BasketView
Предназначен для отображения корзины внутри модального окна и отображения количества элементов в корзине на иконке корзины на главной странице. 
 Устанавливает слушатели на клик принажатии на кнопку оформления заказа внутри модального окна и на иконку корзины на главной странице
constructor(container: HTMLElement, events: IEvents) Конструктор принимает DOM элемент темплейта корзины и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса:
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных;
- _cardsList:HTMLElement - элемент ul списка товаров, находящихся в корзине
- basketButton:HTMLButtonElement - кнопка оформления заказа;
- _basketPrice:HTMLElement - элемент отображения стоимости корзины;
- headerBasketButton:HTMLButtonElement - кнопка корзины на главной странице;
- headerBasketCounter:HTMLElement - элемент отображения количества товаров в корзине

Методы:
- renderHeaderBasketCounter(value: number):void - отображает количество товаров в корзине;
- сеттер basketPrice - отображает цену товаров в корзине и сообщение "Корзина пуста", если товары в корзине отсутствуют;
- сеттер items - отображают переданный массив html элементов товаров в корзине

#### Класс CardsContainer
Предназначен для отображения массива карточек на главной странице. 
constructor(container: HTMLElement) Конструктор принимает элемент, внутри которого будет отображаться массив html элементов.
- сеттер catalog - заменяет все элементы внутри container на переданный массив html элементов

#### Класс SuccessView
Предназначен для отображения успешного результата покупки внутри модального окна. 
 Устанавливает слушатели на клик при нажатии на кнопку успешного оформления заказа
constructor(container: HTMLElement, events: IEvents) Конструктор принимает DOM элемент темплейта успешного оформления заказа и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса:
- button: HTMLButtonElement - кнопка успешного оформления заказа
- events:IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных;
- _fullSum : HTMLElement - элемент для отображения общей стоимости покупки
методы:
- сеттер fullSum - отображает полную стоимость покупки

#### Класс CardView
Предназначен для отображения элемента карточки на главной страницы, при открытии модального окна карточки и для отображения элемента карточки внутри корзины. 
Устанавливает слушатели на клик при нажатии на кнопку добавления в корзину, удаления из корзины и при нажатии на карточку на главной странице сайта для отображения полной информации о товаре.
constructor(container: HTMLElement, events: IEvents) Конструктор принимает DOM элемент темплейта успешного оформления заказа и экземпляр класса `EventEmitter` для возможности инициации событий.
Поля класса:
- _category?: HTMLElement - элемент для отображения категории товара;
- _title: HTMLElement - элемент для отображения заголовка;
- _image?: HTMLImageElement - элемент отбражения изображения;
- _price: HTMLElement - элемент отображения цены товара;
- _button: HTMLButtonElement - кнопка для добавления либо удаления товара в зависимости от открытого модального окна;
- _description?: HTMLElement - элемент для отображения описания товара;
- events: IEvents - - экземпляр класса `EventEmitter` для инициации событий при изменении данных;
- _cardId:string - сохраняет id карточки
- index:HTMLElement - сохраняет номер элемента карточки в корзине
Методы:
- сеттеры для отображения элементов разметки карточки и id карточки
- геттер для id карточки
- renderIndex (index:number):void - отображения порядкового номера карточки в корзине

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

*События изменения данных (генерируются классами моделями данных)*
`orderformErrors:change` - событие, сообщающее о валидации данных в форме выбора способа оплаты и введения адреса, а также сообщающее необходимости обновления отображения ошибок валидации\
`contactformErrors:change`- событие, сообщающее о валидации данных в форме введения телефона и e-mail, а также сообщающее необходимости обновления отображения ошибок валидации\


*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
`basket:add` - добавление товара в корзину\
`basket:delete` - удаление товара из корзины\
`card:open` - открытие подробной информации о товаре\
`basket:buy` - открытие модального окна с выбором способа оплаты и введением адреса пользователя\
`basket:open` - открытие модального окна с корзиной\
`payment:change` - событие, сообщающее о выборе или смене способа оплаты товара\
`order.address:change` - изменение данных в поле ввода адреса\
`contacts.email:change` - изменение данных в поле ввода email\
`contacts.phone:change` - изменение данных в поле ввода телефона\
`order:submit` - сохранение данных пользователя (адрес и способ оплаты)\
`contacts:submit` - сохранение данных пользователя (телефон и e-mail)\
`modal:open` - открытие модального окна\
`modal:close` - закрытие модального окна\
`success` - открытие страницы с каталогом товаром (главной страницы)\